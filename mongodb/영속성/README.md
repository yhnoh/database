
### 저널링을 통한 영속성
- 몽고DB는 저널(journal)이라는 로그선행기입(WAL: write-ahead log)을 사용한다.
  - 데이터베이스 자체에 변경사항을 적용하기 전에 디스크에 먼저 변경사항을 작성한다.
  - 해당 변경사항을 미리 작성함으로써 서버가 갑자기 중지되어 재시작할 때, 저널 파일을 이용하여 데이터베이스 변경사항을 다시 작성한다.
  - 변경사항이 데이터베이스에 적용되어 영속성을 가지게되면(새로운 체크포인트) 오래된 저널 파일을 유지할 이유가 없기 때문에 자동으로 삭제된다.

> [MongoDB > 저널링](https://www.mongodb.com/ko-kr/docs/manual/core/journaling/)




- 복제셋에 쓰기 작업 진행시 모든 복제된 컬렉션의 데이터에 대해 몽고DB는 저널항목을 생성
  - 작업 로그를 기반으로하는 명령문 기반 복제
- 서버가 갑자기 중지되면서 재시작할 때 저널을 사용함으로써 종료 전에 디스크에 플러시되지 않은 쓰기를 다시 진행할 수 있다.
- 몽고DB는 dbPath 디렉터리에 journal이라는 서브 디렉터리를 만든다.
  - 저널 파일의 크기 제한은 약 100메가바이트이며, 크기 제한을 초과하면 몽고DB는 새 저널 파일을 만들고 거기에 다시 작성한다.
  - 오래된 저널파일은 자동으로 제거

- 몽고DB에서 개별 도큐먼트에 대한 작업은 원자적이다. 많은 애플리케이션에서 다중 도큐먼트 트랜잭션이 필요하지 않다.
- 여러 도큐먼트를 갱신할 때 원자성이 필요한 경우가 있으므로 몽고DB는 복제셋에 대해 다중 다큐먼트 트랜잭션을 수행하는 기능을 제공한다.
  - 트랜잭션을 사용하면 트랜잭션 내의 모든 데이터 변경이 성공해야하며, 실패하면 트랜잭션이 중단되고 모든 데이터 변경사항은 롤백된다.

### 클러스터 수준에서의 영속성 보장

- 쓰기결과확인을 통한 영속성 보장
  - 쓰기가 복제셋 멤버 대부분에 성공적으로 복제되었을 때만 쓰기가 성공적으로 완료됨을 서버로부터 확인받고자 함을의미