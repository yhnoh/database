


### 클러스터링 인덱스

- 클러스터링 인덱스는 프라이머리 키에 대해서만 적용되는 내용이다.
- 프라이머리 키 값에 의해 레코드의 저장 위치가 결정되며, 프라이머리 카 값에 의해 레코드의 저장 위치가 결정된다.
    - 인덱스 컬럼을 수정할 경우, 인덱스의 삭제 및 저장으로 인해서 B-Tree 인덱스의 저장 위치만 변경이 되지만, 프라이머리 키의 경우는 레코드의 저장 위치도 변경이 된다.
    - 때문에 프라이머리 키의 변경은 꽤나 큰 비용을 소모하게 될 수 있다.
- InnoDB의 경우 항상 클러스터링 인덱스로 저장되는 테이블은 프라이머리 키 기반의 검색이 매우 빠르며, 대신 레코드의 저장 이나 프라이머리 키의 변경이 상대적으로 느리다.
- 클러스터링 인덱스의 리프노드에는 모든 컬럼이 같이 저장되어 있다. 클러스터링 테이블은 그 자체가 하나의 거대한 구조로 관리되는 것이다.
- InnoDB 스토리지 엔진의 경우 인덱스가 프라이머리 키 값을 가지고 이
- 만약 이런 구조가 아니라면 클러스터링 키 값이 변경될 때마다 데이터 레코드의 주소가 변경되고 그때마다 해당 테이블의 모든 인덱스에 저장된 주소값을 변경해야한다.
- 때문에 세컨더리 인덱스는 레코드가 저장된 주소가 아니라 프라이머리 키 값을 저장하도록 구현되어 있다.

프라이머리 키가 없는 경우는 프라이머리 키를 대체할 컬럼을 선택한다.
1. 프라이머리 키가 있으면 프라이머리 키를 클러스터링 키로 선택
2. NOT NULL 옵션의 유니크 인덱스중에서 첫 번째 인덱스를 클러스터링 키로 선택
3. 자동으로 유니크한 값을 가지도록 증가되는 컬럼을 내부적으로 추가한 후, 클러스터링 키로 선택
    - 프라이머리 키나 유니크 인덱스가 없는 경우 아무 의미 없는 숫자 값으로 클러스터링 되며, 이는 아무 혜택도 주지 못한다.
- 클러스터링 인덱스는 테이블당 단 하나만 가질 수 있으며 많은 장점이 있기 때문에 프라이머리 키를 명시하는 것이 좋다.



### 유니크 인덱스

- 유니크 인덱스는 테이블이나 인덱스에 값이 중복될 수 없는 인덱스를 의미한다.
  - 제약 조건을 가진 인덱스이며 MySQL에서는 인덱스 없이 유니크 제약만 설정할 방법이 없다.
- 인덱스 쓰기
  - 일반적인 인덱스의 경우 값이 중복될 수 있기 때문에 중복된 값을 체크하지 않고 데이터를 작성할 수 있다.
  - 하지만 유니크 인덱스의 경우 중복을 허용하지 않기 때문에 중복 체크를 진행하다.
  - MySQL에서는 유니크 인덱스에서 중복된 값을 체크할 때는 읽기 잠감을 사용하고, 쓰기를 할 때는 쓰기 잠금을 사용하는데 이 과정에서 데드락이 빈번하게 사용된다.
  - 또한 인덱스의 저장이나 변경 작업시 InnoDB 스토리지 엔진에서는 체인지 버퍼가 사용되지만, 유니크 인덱스는 반드시 중복 체크를 해야 하므로 작업 자체를 버퍼링하지 못하다.
  - 